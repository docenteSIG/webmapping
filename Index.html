<!DOCTYPE html> 
<html> 
<head>

<meta charset="UTF-8"> 
     
<!-- Lo primero es como siempre definir las condiciones para la visualización en el dispositivo móvil.-->  
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, userscalable=no" /> 

 
<title>Visor de Florencia</title> 


<!--  Carga de la libreria Leaflet  -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

	
<!--Cargamos plugin MarkerCluster -->
	<link rel="stylesheet" href="css/MarkerCluster.css" />
	<link rel="stylesheet" href="css/MarkerCluster.Default.css" />
	<script src="lib/leaflet.markercluster.js"></script>
	
	
<!--  Carga dbotones Easy  -->
<script src="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.css">
 
<!--  fullscreen -->
<link href='https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/leaflet.fullscreen.css' rel='stylesheet' />
<script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/Leaflet.fullscreen.min.js'></script>


<!--  Bootstrap  -->
<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
 
 <!-- Plugin Leaflet.awesome-markers  -->	
 <link rel="stylesheet" href="lib/Leaflet.awesome-markers-2.0-develop/dist/leaflet.awesome-markers.css">
 <script src="lib/Leaflet.awesome-markers-2.0-develop/dist/leaflet.awesome-markers.js"></script>
	
<!-- Plugin minimap  -->	
<script src="lib/Control.MiniMap.js"></script>
<link rel="stylesheet" href="css/Control.MiniMap.css" />

<!-- Control Capas  -->
<link rel="stylesheet" href="css/styledLayerControl.css" />
<script src="lib/styledLayerControl.js"></script>

<!-- capas de datos -->
<script src="json/barrio.js"></script>
<script src="json/manzana.js"></script>
<script src="json/perimetro.js"></script>
<script src="json/luminaria.js"></script>

<!--barra lateral -->
<link rel="stylesheet" href="css/leaflet-sidebar.css" />
<script src="lib/leaflet-sidebar.js"></script>
<script src="cervantes.js"></script>

<!--Control busqueda -->
<link rel="stylesheet" href="css/leaflet-search.css" />
<script src="lib/leaflet.search.js"></script>

	<style> 
	
		body {
		padding: 0; 
		margin: 0; 
		     } 
		html, body, #map { 
		height: 100%; 
		     } 
		.target{
		font-size: 2.8em;
		color:black
		} 
		
		.lorem {
 font-style: italic;
 color: #666666;
 }
		
		.target2{
		font-size: 1em;
		color:red
		} 	

 #mitexto {
            font: 10pt "Helvetica Neue", Arial, Helvetica, sans-serif;
             color: #1a1a1a;
             position: absolute;
             right: 20px;
             width: 350px;
             border: 3px solid #AAA;
             padding: 10px;
             background-color:#e6e6e6; 
        }



		.awesome-marker i {
        font-size: 2px;
        margin-top: 8px;
		
       }
		.ac-container {
		background: #d6ff99 ;
		
		}
		
		.leaflet-popup-content {
		padding: 1px;
		background:#f1b10e;
		}
		.leaflet-popup-content-wrapper{
		background:#ebcb7a;
		}
		.leaflet-popup-tip {
		background:red;
		}
		.imgpop{
		 width: 150px;
		 }

 
			 
	</style> 
</head>   
	<body>

    <div id="sidebar" class="sidebar collapsed">
        <!-- Nav tabs -->
        <div class="sidebar-tabs">
            <ul role="tablist">
                <li><a href="#home" role="tab"><i class="fa fa-bars"></i></a></li>
                <li><a href="#retrato" role="tab"><i class="fa fa-user"></i></a></li>
                <li><a href="#libros" role="tab"><i class="fa fa-file-text-o"></i></a></li>
                <li><a href="https://www.youtube.com/watch?v=HAxjVeqKH_8" role="tab" target="_blank"><i class="fa fa-youtube"></i></a></li>
				<li><a role="tab"><i class="glyphicon glyphicon-home"></i></a></li>
				<li><a role="tab"><i class="fa fa-location-arrow"></i></a></li>
				
								
            </ul>

            <ul role="tablist">
                <li><a href="https://es.wikipedia.org/wiki/Miguel_de_Cervantes" role="tab"><i class="fa fa-wikipedia-w"></i></a></li>
            </ul>
        </div>

        <!-- Tab panes -->
        <div class="sidebar-content">
            <div class="sidebar-pane" id="home">
                <h1 class="sidebar-header">
                    SIG Florencia
                    <span class="sidebar-close"><i class="fa fa-caret-left"></i></span>
                </h1>
                <br>
                <p>Una aplicación Web Mapping nos permite permite visualizar cartografía en internet e interactuar con los mapas y con los datos.</p>

                <p class="lorem">SIG Florencia, es una aplicación Web Mapping que pemrite visualizar e interactuar con informacion temática, catastral y base de la ciudad de 
				Florencia y sus alrededores.</p>
				
				<p class="lorem">En esta aplicación encontraremos la ubicación espacial de las luminarias públicas de la ciudad, mediante la cual se podra buscar y locaizar mediante su código único. 
				De igual forma capas como Manzanas Urbanas, Peímetro de la ciudad y barrios.</p>
				
				<p class="lorem">Como proceso base, los usuarios podrán generar rutas desde la misma apliacaión para llegar a los sitios que deseeen..</p>

            </div>

            <div class="sidebar-pane" id="retrato">
                <h1 class="sidebar-header">Retrato de Cervantes<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
                <p><a href="https://commons.wikimedia.org/wiki/File:Cervantes_J%C3%A1uregui.jpg#/media/File:Cervantes_J%C3%A1uregui.jpg"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/09/Cervantes_J%C3%A1uregui.jpg/1200px-Cervantes_J%C3%A1uregui.jpg" alt="Cervantes Jáuregui.jpg" width="360" height="560"></a>

            </div>

            <div class="sidebar-pane" id="libros">
                <h1 class="sidebar-header">Obras publicadas<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
                <ul><li>La Galatea (1585)</li>
                <li>El ingenioso hidalgo don Quijote de la Mancha (1605)</li>
                <li>Novelas ejemplares (1613)</li>
                <li>El ingenioso caballero don Quijote de la Mancha (1615)</li>
                <li>Los trabajos de Persiles y Sigismunda (1617)</li>
                </ul>
            </div>

            <div id="mitexto"></div>
        </div>
    </div>


	  
	  
<!-------------------------DIV MAP---------------------------------------------------->	  
		 
		<div id = "map" class="sidebar-map"> </div>  
		
		
			<script type="text/javascript"> 
			
			var osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png');
			var GoogleSatelite = L.tileLayer('http://www.google.cn/maps/vt?lyrs=s@189&gl=cn&x={x}&y={y}&z={z}');     			
			var GoogleMaps = L.tileLayer('https://mt1.google.com/vt/lyrs=r&x={x}&y={y}&z={z}');  
			var GoogleRoad = L.tileLayer('https://mt1.google.com/vt/lyrs=h&x={x}&y={y}&z={z}'); 

			var Watercolor = L.tileLayer('https://tiles.stadiamaps.com/tiles/stamen_watercolor/{z}/{x}/{y}.jpg');     			
			var CartoDark = L.tileLayer('http://a.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png');  
			
			
			var osm2 = new L.TileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{minZoom: 0, maxZoom: 13});
			
			//1.62, -75.61 40.965, -5.664], 15
			
			var map = L.map('map', {    
			center: [1.62, -75.61],    
			zoom: 13,    
			layers: osm          			
									});
									
									
									
	 	
	 // *****************************************************CAPAS******************************************************************************************
		
		//------------------------ESTILOS DE CAPAS--------------------------							
		
        var perimetroStyle = {
			color: 'green',
			weight: 2,
			dashArray:'3',
			fillColor: "transparent",//'#f03',
			fillOpacity: 0.5
                            };
    
		var barrioStyle = {
			color: 'red',
			weight: 0.8,
			dashArray:'3',
			fillColor: "transparent",//'#f03',
			fillOpacity: 0.5
		};
    
		var ManzanaStyle = {
			color: "#111",
			weight: 0.8,
			//dashArray:'3',
			fillColor : "#FFCC99",
			fillOpacity: 0.8
		};

     //--------------------POPUS PARA CAPAS JS-----------------------------------
	 
		function popupBarrio(feature, layer) {
			if (feature.properties && feature.properties.nombre) {
				layer.bindPopup(feature.properties.nombre);
																	}
		}

	//--------------------CARGUE DE CAPAS JS---------------------------------------
					
		//var geoJsonLayerLuminarias =  L.geoJSON(lum).addTo(map);	
	 	var geoJsonLayerBarrios = L.geoJSON(barrios,{style:barrioStyle,onEachFeature: popupBarrio }).addTo(map);
		var geoJsonLayerManzanas =  L.geoJSON(manzana,{style:ManzanaStyle}).addTo(map);
		var geoJsonLayerPerimetro =  L.geoJSON(per,{style:perimetroStyle}).addTo(map);
        
		
		
	//--------------------PLUGIN CLUSTER LUMINARIAS--------------------------------
      
     var markers = L.markerClusterGroup();

		var monumentos = L.geoJSON(lum, {
			onEachFeature: function (feature, layer) {
				layer.bindPopup("<ul><h3>" +feature.properties.consecu+" </h3><figure><img class='imgpop' src=json/"+feature.properties.fotografia+"></figure><li>Estado: " 
				+feature.properties.est_ilumin+"</li><li>PotenciaW: " 
				+feature.properties.potencia+"</li></ul>");
				
			//
		
			}
		});
		markers.addLayer(monumentos);

		map.addLayer(markers);
        
		
		
		// AGREGAMOS LA INFORMACION DE LA LUMINARIA AL SIDELAYER..
		monumentos.on('click', function (e) {
                //console.log(e.layer.feature.properties.historia);
                var y= "<ul><li> Codigo: "+e.layer.feature.properties.cod_ilumin+"</li><li>Estado: "+e.layer.feature.properties.est_ilumin+"</li><ul>";
						
                document.getElementById("mitexto").innerHTML =y;
            });

     //*************************************************************CONTROLES *****************************************************************	 
	// sidebar---------------------------------------------------------------------
	  
	  var sidebar = L.control.sidebar('sidebar').addTo(map);
	 
	 	 
	 
	 // MiniMapa-------------------------------------------------------------------
	 
	 var miniMap = new L.Control.MiniMap(osm2, { toggleDisplay: true }).addTo(map);
     
	 //Añadimos fullscreen
	 map.addControl(new L.Control.Fullscreen());
	 
	 //--------------------CAPAS----------------------------------------------------
	 
			 var baseMaps = [
				{
				 groupName : "Capas Google",
				 expanded : true,
				 layers : {
				 "Satelite" :GoogleSatelite,
				 "Maps" :GoogleMaps,
				 "Roads" :GoogleRoad,
				}
				}, {
				groupName : "OSM",
				layers : {
				"OSM" : osm
				}
				 }, {
				groupName : "Otros",
				layers : {
				"Watercolor" : Watercolor,
				"Carto Dark": CartoDark
				}
				}
				];
				var overlays = [
				{
				groupName : "Catastro Florencia",
				expanded : true,
				layers : {
				"Perimetro" : geoJsonLayerPerimetro,
				"Barrios" : geoJsonLayerBarrios,
				"Manzanas" : geoJsonLayerManzanas,
				"Luminarias" : markers,
				}
				 }
				];
				var options = {
				container_width : "200px",
				container_maxHeight : "350px",
				group_maxHeight : "120px",
				exclusive : true,
				collapsed : true,
				position: 'topright'
				};
				var control = L.Control.styledLayerControl(baseMaps, overlays, options);
				map.addControl(control);
				//-------------evento capa seleccionada-------------------------	 
				
				map.on('overlayadd', function(sl) {
				 if (sl.name === 'Perimetro') {
					alert(sl.name);
				 }if (sl.name === 'Manzanas') {
					alert(sl.name);
				}else if (sl.name === 'Barrios') {
					alert(sl.name);
					//map.fitBounds(linebounds)
				}else if (sl.name === 'Luminarias') {
					alert(sl.name);
					//map.fitBounds(plazabounds)
				}
				});
				
	   //---------------------------CONTROL BUSCADOR BARRIO-------------------------
     
    
		var searchControl = new L.Control.Search({
				layer: geoJsonLayerBarrios,
				propertyName: 'nombre',
				circleLocation:true,
				initial: false,
				//container: 'findbox',
				collapsed: false
				});
        map.addControl( searchControl );
			
	 
	 // Botones easybutton...son cargados a sidebar en el menu y desde alla llama a la fucion s egun la clase asignada ------------------------------------------------
	
				
				// Boton home--------------------------
				var casa = [1.62, -75.61];
				var vista = document.getElementsByClassName("glyphicon glyphicon-home");
				vista[0].onclick = function () { map.flyTo(casa, 13); };
				
				
				
				// Boton Geolocalizacion
				var localizacion = document.getElementsByClassName("fa fa-location-arrow");
				localizacion[0].onclick = function(){

						function buscarLocalizacion(e) {
						
						var mydate = new Date(e.timestamp);
						L.marker(e.latlng).addTo(map).bindPopup(mydate.toString());
						
						}

						function errorLocalizacion(e) {
							alert("No es posible encontrar su ubicación. Es posible que tenga que activar la Geolocation.");
						}

						map.on('locationerror', errorLocalizacion);
						map.on('locationfound', buscarLocalizacion);
						map.locate({setView: true, maxZoom:12});
        	
					};
				
				
				
				
	/*  estos botones se agregaban en el mapa, pero ahora los utilizo desde el sidebar...
	 L.easyButton( '<span class="target">&target;</span>', function(){

   		function buscarLocalizacion(e) {
		
		var mydate = new Date(e.timestamp);
		L.marker(e.latlng).addTo(map).bindPopup(mydate.toString());
		
		}

		function errorLocalizacion(e) {
    		alert("No es posible encontrar su ubicación. Es posible que tenga que activar la Geolocation.");
		}

		map.on('locationerror', errorLocalizacion);
		map.on('locationfound', buscarLocalizacion);
		map.locate({setView: true, maxZoom:12});
        
		
		}).addTo(map);

	 // Boton Easy Home
	     var home=[1.62, -75.61];
		 L.easyButton( '<span class="target">&sext;</span>', function(){
			map.flyTo(home,14);
		}).addTo(map);
		
		
	// Boton Easy Home - iconos de awamesome
	    
		 L.easyButton( '<span class="glyphicon glyphicon-home" aria-hidden="true"}></span>', function(){
			alert();
		}).addTo(map);
			
		L.easyButton('<i class="fas fa-car"></i>', function(){
			alert('Has hecho clic en un botón del plugin easyButton');
	}).addTo(map);	
		
			L.easyButton('<i class="fas fa-money"></i>', function(){
			alert('Has hecho clic en un botón del plugin easyButton');
	}).addTo(map);	
		
*/
							
		    </script> 
	</body> 
</html> 